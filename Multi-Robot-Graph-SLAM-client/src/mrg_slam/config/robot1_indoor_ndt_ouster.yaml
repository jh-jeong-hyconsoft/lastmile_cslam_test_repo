"/**":
  ros__parameters:
    robot_namespace: "robot1"
    use_sim_time: true
    lidar_points_topic: "/robot1/ouster/points"
    wheel_odom_topic: "/robot1/odom"
    enable_slam_tf_broadcast: false

# PrefilteringComponent (실내: 근거리·고밀도)
prefiltering_component:
  ros__parameters:
    enable_prefiltering: true
    base_link_frame: "base_link"        # launch에서 robot_namespace prefix

    downsample_method: "VOXELGRID"
    downsample_resolution: 0.2         # 실내 고밀도
    downsample_min_points_per_voxel: 1

    # Outlier removal - 더 완화
    outlier_removal_method: "RADIUS"  # STATISTICAL → RADIUS (덜 엄격)
    statistical_mean_k: 30
    statistical_stddev: 1.5  # 1.0 → 1.5 (더 완화)
    radius_radius: 0.8  # 0.5 → 0.8
    radius_min_neighbors: 2

    enable_distance_filter: true
    distance_near_thresh: 0.8  # 0.5 → 0.8 (완화)
    distance_far_thresh: 20.0  # 15.0 → 20.0 (실내+복도)

    enable_deskewing: true
    scan_period: 0.05                   # OS1 20Hz ≈ 0.05s

    filtered_points_publish_rate: 1.5   # Hz, 실내 빠른 업데이트

# ScanMatchingOdometryComponent
scan_matching_odometry_component:
  ros__parameters:
    enable_tf_broadcast: false
    enable_scan_matching_odometry: true
    odom_frame_id: "odom"
    robot_odom_frame_id: "odom"

    downsample_method: "VOXELGRID"
    downsample_resolution: 0.2
    downsample_min_points_per_voxel: 1

    keyframe_delta_translation: 0.5    # 실내 촘촘
    keyframe_delta_angle: 0.01
    keyframe_delta_time: 3.0

    registration_method: "NDT_OMP"
    reg_num_threads: 8
    reg_transformation_epsilon: 0.01
    reg_maximum_iterations: 60
    reg_max_correspondence_distance: 2.0
    reg_use_reciprocal_correspondences: false
    reg_correspondence_randomness: 20
    reg_resolution: 0.4                 # NDT voxel
    reg_nn_search_method: "DIRECT7"

    enable_robot_odometry_init_guess: true
    enable_imu_frontend: false

    publish_pose_with_covariance: true
    publish_map_pose: true
    map_frame_id: "map"
    pose_cov_frame_id: "odom" 
    pose_cov_base_pos: 0.005
    pose_cov_base_rot: 0.01

# MrgSlamComponent (백엔드 그래프)
mrg_slam_component:
  ros__parameters:
    enable_mrg_slam: true
    map_frame_id: "map"
    odom_frame_id: "odom"

    g2o_solver_type: "lm_var_cholmod"
    g2o_solver_num_iterations: 384
    use_custom_inf_matrix_first_node: true
    graph_update_interval: 0.5          # 실내: 잦은 최적화

    candidate_max_xy_distance: 8.0
    fitness_score_thresh: 2.0
    registration_method: "SMALL_GICP"

    enable_keyframe_event_publish: true
    keyframe_event_downsample_resolution: 0.3
    reg_max_correspondence_distance: 2.0
    use_planar_registration_guess: true

    publish_slam_pose_with_covariance: true
    slam_pose_cov_base_pos: 0.02
    slam_pose_cov_base_rot: 0.04
    slam_pose_cov_fitness_ref: 0.4
    slam_pose_cov_fitness_scale: 5.0

    # Map 생성 - 매우 완화
    map_cloud_resolution: 0.05
    map_cloud_min_points_per_voxel: 1  # 2 → 1 (최대 완화)
    map_cloud_distance_far_thresh: 25.0  # 20.0 → 25.0

    # Floor detection 활성화
    enable_floor_coeffs: true

    enable_gps: false
    save_graph: false

# KeyframeUploaderComponent
keyframe_uploader:
  ros__parameters:
    enable_upload: false
    rate_limit: 1.0                     # Hz

# FloorDetectionComponent
floor_detection_component:
  ros__parameters:
    enable_floor_detection: true
    tilt_deg: 0.0
    sensor_height: 0.109  # 0.34 → 0.109 (URDF: base_link z=0.109)
    height_clip_range: 0.5  # 0.4 → 0.5 (더 넓게)
    floor_pts_thresh: 256  # 512 → 256 (실내용)
    floor_normal_thresh_deg: 15.0  # 10.0 → 15.0 (더 관대)
    enable_normal_filtering: true
    normal_filter_thresh_deg: 20.0
